var he=Object.defineProperty;var pe=(r,t,e)=>t in r?he(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var O=(r,t,e)=>(pe(r,typeof t!="symbol"?t+"":t,e),e);import{c as te,w as U,y as T,z as D,A as re,B as ve,g as ne,C as x,D as ye,E as me,r as ge,j as be,F as W,h as we,G as Re,m as $,H as _e}from"./index.ac80e2a5.js";import{a as w}from"./axios.7331a07d.js";const{passive:V}=x,Se=["both","horizontal","vertical"];var ot=te({name:"QScrollObserver",props:{axis:{type:String,validator:r=>Se.includes(r),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(r,{emit:t}){const e={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let i=null,o,n;U(()=>r.scrollTarget,()=>{c(),l()});function a(){i!==null&&i();const p=Math.max(0,ye(o)),g=me(o),u={top:p-e.position.top,left:g-e.position.left};if(r.axis==="vertical"&&u.top===0||r.axis==="horizontal"&&u.left===0)return;const h=Math.abs(u.top)>=Math.abs(u.left)?u.top<0?"up":"down":u.left<0?"left":"right";e.position={top:p,left:g},e.directionChanged=e.direction!==h,e.delta=u,e.directionChanged===!0&&(e.direction=h,e.inflectionPoint=e.position),t("scroll",{...e})}function l(){o=ve(n,r.scrollTarget),o.addEventListener("scroll",s,V),s(!0)}function c(){o!==void 0&&(o.removeEventListener("scroll",s,V),o=void 0)}function s(p){if(p===!0||r.debounce===0||r.debounce==="0")a();else if(i===null){const[g,u]=r.debounce?[setTimeout(a,r.debounce),clearTimeout]:[requestAnimationFrame(a),cancelAnimationFrame];i=()=>{u(g),i=null}}}const{proxy:f}=ne();return U(()=>f.$q.lang.rtl,a),T(()=>{n=f.$el.parentNode,l()}),D(()=>{i!==null&&i(),c()}),Object.assign(f,{trigger:s,getPosition:()=>e}),re}});function Oe(){const r=ge(!be.value);return r.value===!1&&T(()=>{r.value=!0}),r}const ie=typeof ResizeObserver!="undefined",H=ie===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"};var st=te({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(r,{emit:t}){let e=null,i,o={width:-1,height:-1};function n(c){c===!0||r.debounce===0||r.debounce==="0"?a():e===null&&(e=setTimeout(a,r.debounce))}function a(){if(e!==null&&(clearTimeout(e),e=null),i){const{offsetWidth:c,offsetHeight:s}=i;(c!==o.width||s!==o.height)&&(o={width:c,height:s},t("resize",o))}}const{proxy:l}=ne();if(ie===!0){let c;const s=f=>{i=l.$el.parentNode,i?(c=new ResizeObserver(n),c.observe(i),a()):f!==!0&&W(()=>{s(!0)})};return T(()=>{s()}),D(()=>{e!==null&&clearTimeout(e),c!==void 0&&(c.disconnect!==void 0?c.disconnect():i&&c.unobserve(i))}),re}else{let f=function(){e!==null&&(clearTimeout(e),e=null),s!==void 0&&(s.removeEventListener!==void 0&&s.removeEventListener("resize",n,x.passive),s=void 0)},p=function(){f(),i&&i.contentDocument&&(s=i.contentDocument.defaultView,s.addEventListener("resize",n,x.passive),a())};const c=Oe();let s;return T(()=>{W(()=>{i=l.$el,i&&p()})}),D(f),l.trigger=n,()=>{if(c.value===!0)return we("object",{style:H.style,tabindex:-1,type:"text/html",data:H.url,"aria-hidden":"true",onLoad:p})}}}});const S="https://api.github.com";class Pe{constructor(){O(this,"data");this.data={}}async get(t,e){return this.data[t]===void 0?e:JSON.parse(this.data[t])}async set(t,e){this.data[t]=JSON.stringify(e)}async clear(){this.data={}}}let C=new Pe;function at(r){C=r}function R(r,t){return{...{Accept:"application/vnd.github+json",Authorization:`Bearer ${r}`},...t}}async function B({repo:r,token:t}){return(await w.get(`${S}/repos/${r}`,{headers:R(t)})).data}async function F({repo:r,branch:t,token:e}){t||(t=(await B({repo:r,token:e})).default_branch);const i=new Date;return i.setSeconds(i.getSeconds()-30),(await w.get(`${S}/repos/${r}/branches/${t}`,{headers:R(e,{"If-Modified-Since":i.toUTCString()})})).data}async function ct({input:r,token:t}){r.startsWith("https://github.com/")&&(r=r.substring(19));const e=r.match(/^[^\/]+\/[^\/#]+/);let i;if(e)i=e[0];else throw new Error("Invalid repository");r=r.substring(i.length),r.startsWith("/")&&(r=r.substring(1));const o=await B({repo:i,token:t});let[n,a]=r.split("#");return n==="/"&&(n=""),a&&(a=(await F({repo:i,branch:a,token:t})).name),{repr:`${o.full_name}${n?`/${n}`:""}${a?`#${a}`:""}`,repo:o.full_name,path:n,branch:a}}function Ce(r){let t=r.match(/^.*?(\.[^\.]*)?$/)[1];return t?(t=t.toLowerCase(),t==".stp"&&(t=".step"),[".step",".f3d",".svg",".dxf"].indexOf(t)!==-1?t.substring(1):t===".png"?"thumb":t===".json"?"meta":null):null}function oe({tree:r,root:t,id_prefix:e,repo:i,branch:o}){var a,l;const n=[];for(;r.length>0;){let c={...r[0],id:`${e}|${r[0].path}`,name:((l=(a=r[0].path.split("/").pop())==null?void 0:a.match(/^(.*?)(\.[^\.]*)?$/))==null?void 0:l[0])||""};if(!c.path.startsWith(t))break;if(r.shift(),c.type=="tree"){if(c.children=oe({tree:r,root:`${c.path}/`,id_prefix:e,repo:i,branch:o}),c.children.length===0)continue}else if(c.type=="blob"){const s=Ce(c.path);if(!s)continue;if(c.content_types={[s]:{url:c.url,size:c.size,path:c.path,repo:i,branch:o}},c.path=c.path.match(/^(.*?)(\.[^\.]*)?$/)[1],c.name=c.name.match(/^(.*?)(\.[^\.]*)?$/)[1],n.length>0){const f=n[n.length-1];f.type==="blob"&&f.path===c.path&&(n.pop(),c=se(f,c))}}n.push(c)}return n}function L(r,t){const e=[...r];return t.forEach(i=>{let o=r.filter(n=>n.name==i.name&&n.type==i.type)[0];if(!o){e.push(i);return}o.sha=[...o.sha.split(":").filter(n=>!!n),...i.sha.split(":").filter(n=>!!n)].join(":"),o.type==="tree"?o.children=L(o.children||[],i.children||[]):(e.splice(e.indexOf(o),1),o=se(o,i),e.push(o))}),e}function se(r,t){return{...r,content_types:{...r.content_types,...t.content_types}}}async function Ne({repo:r,branch:t,token:e,id_prefix:i}){var a,l;let o;try{o=await F({repo:r,branch:t,token:e})}catch(c){if(((l=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:l.message)==="Branch not found")return[[],null];throw c}console.log(o);let n=await C.get(`cache:tree:${r}:${o.name}`);return(!n||n.sha!==o.commit.commit.tree.sha)&&(console.log("cache miss",r,o.commit.commit),n=(await w.get(`${S}/repos/${r}/git/trees/${o.commit.commit.tree.sha}?recursive=1`,{headers:R(e)})).data,await C.set(`cache:tree:${r}:${o.name}`,n)),[oe({tree:n.tree,root:"",id_prefix:i,repo:r,branch:o.name}),o.commit.commit.tree.sha]}function Je(r,t){t=t.replace(/^\//,"").replace("//$","");let e=r;t.split("/").forEach(o=>{var n;if(e=(n=e.filter(a=>a.name===o&&a.type=="tree")[0])==null?void 0:n.children,r===void 0)throw Error("Invalid repository path")});function i(o,n){const a=[];for(const l of o){const c={...l};c.path=c.path.substring(n.length+1);const[s,f]=c.id.split("|");c.id=`${s}|${f.substring(n.length+1)}`,c.type==="tree"&&c.children&&(c.children=i(c.children,n)),a.push(c)}return a}return r=i(r,t),r}async function G({repositories:r,token:t,id_prefix:e,index:i,setLoadingMessage:o}){let n=[];const a=[];for(const c of r){o&&o(`Loading ${c}...`);const s=c.match(/^([\w-]+)\/([\w-]+)((?:\/[\w-]+)*)(#.*)?$/);if(s!=null){const[,f,p,g,u]=s;let h=u;h?h=h.substring(1):h=(await B({repo:`${f}/${p}`,token:t})).default_branch,o&&o(`Loading ${c}#${h}...`);const[d,v]=await Ne({repo:`${f}/${p}`,branch:h,token:t,id_prefix:e});v&&(a.push(v),g?n=L(n,Je(d,g)):n=L(n,d))}}if(i){let c=0;const s=Ee(n);n=await ue({tree:n,token:t,treeShas:a,perNodeFunc:()=>{c++,o&&o(`Indexing trees (${c}/${s})...`)}})}console.log("Merged trees",n);const l=ce(ae(n));return console.log(l),l}function Ee(r){let t=0;function e(i){if(t++,i.children)for(const o of i.children)e(o)}for(const i of r)e(i);return t}function ae(r){const t=[];return r.forEach(e=>{if(e.type==="tree")e.children=ae(e.children||[]),e.children.length&&t.push(e);else if(e.type==="blob"){const i=e.content_types;i&&(i.step||i.f3d||i.dxf||i.svg)&&t.push(e)}}),t}function ce(r){return r.filter(t=>t.type==="tree").forEach(t=>{ce(t.children||[])}),r.sort($e),r}function $e(r,t){const e=t.type==="tree"?1:0,i=r.type==="tree"?1:0;return e-i||r.path.localeCompare(t.path)}async function le({url:r,token:t}){let e=await C.get(`cache:blob:${r}`,null);return e===null&&(e=(await w.get(r,{headers:R(t)})).data,await C.set(`cache:blob:${r}`,e)),e}async function Me({url:r,token:t}){const e=await w.get(r,{headers:R(t,{Accept:"application/vnd.github.raw"})});return new Blob([e.data])}async function Q({url:r,token:t}){const e=await le({url:r,token:t});let i=e.content;return e.encoding==="base64"&&(i=atob(i)),JSON.parse(i)}async function Te({org:r,token:t}){return(await w.get(`${S}/users/${r}/repos`,R(t))).data.map(i=>({name:i.name,icon:"mdi-github",expandable:!0,type:"repo",repositories:[{repo:i.full_name,repr:i.full_name,branch:i.default_branch}],children:[]}))}async function je({url:r,token:t,content_type:e}){const i=await le({url:r,token:t});return i.encoding!="base64"&&(i.content=btoa(i.content)),`data:${e};base64,${i.content}`}async function ue({tree:r,token:t,treeShas:e,perNodeFunc:i}){var l,c,s,f,p,g,u,h;const o=await C.get(`cache:meta:${e.join(":")}`,null);let n=[];for(const d of r){if(i&&i(d),d.type==="tree"&&d.children){n.push({...d,children:await ue({tree:d.children,token:t,treeShas:d.sha.split(":").filter(_=>!!_),perNodeFunc:i})});continue}let v;if(o)v=o[d.name]||{};else if((c=(l=d.content_types)==null?void 0:l.meta)!=null&&c.url)try{v=await Q({url:((f=(s=d.content_types)==null?void 0:s.meta)==null?void 0:f.url)||"",token:t})}catch{v={}}n.push({...d,meta:v})}const a=n.filter(d=>{var v;return d.name=="_meta"&&((v=d.content_types)==null?void 0:v.meta)})[0];if(a){if(!o){console.log("Downloading meta",(g=(p=a.content_types)==null?void 0:p.meta)==null?void 0:g.url);const d=await Q({url:((h=(u=a.content_types)==null?void 0:u.meta)==null?void 0:h.url)||"",token:t});ke(n,d)}n=n.filter(d=>d.id!==a.id)}if(!o){const d={};n.forEach(v=>{Object.keys(v.meta||{}).length!=0&&(d[v.name]=v.meta)}),Object.keys(d).length!=0&&C.set(`cache:meta:${e.join(":")}`,d)}return n}function ke(r,t){var e;for(const[i,o]of Object.entries(t)){const n=Ae(r,i);n&&n.type=="blob"&&(n.meta={...(n==null?void 0:n.meta)||{},...o||{},keywords:Ie((e=n==null?void 0:n.meta)==null?void 0:e.keywords,o==null?void 0:o.keywords)})}}function Ae(r,t){var i;let e=[...r];if(t){for(const o of t.split("/"))if(Array.isArray(e)?e=e.filter(n=>n.name===o)[0]:e=((i=e.children)==null?void 0:i.filter(n=>n.name===o)[0])||null,!e)return null}return e}function Ie(r,t){r=r||[],t=t||[],r=Array.isArray(r)?r:r.split(/\s+/),t=Array.isArray(t)?t:t.split(/\s+/);const e=r.map(i=>i.toLowerCase());return[...r,...t.filter(i=>e.indexOf(i.toLowerCase())===-1)].join(" ")||void 0}async function lt({repo:r,branch:t,path:e,token:i}){return(await w.get(`${S}/repos/${r}/commits`,{headers:R(i),params:{sha:t,path:e,per_page:"1",page:"1"}})).data[0]}async function ut({repo:r,branch:t,token:e,files:i,message:o,progressCallback:n}){const a=i.reduce((u,h)=>u+h.content.length,0);let l=0;n&&n(0,a),i=await Promise.all(i.map(async u=>{const h=await w.post(`${S}/repos/${r}/git/blobs`,{content:u.content,encoding:u.encoding},{onUploadProgress:d=>{n&&n(l+d.loaded,a)},headers:R(e,{"Content-Type":"application/json"})});return l+=u.content.length,n&&n(l,a),{mode:"100644",type:"blob",sha:h.data.sha,path:u.path}}));const c=await F({repo:r,branch:t,token:e}),s=c.commit.commit.tree.sha;let f=await w.post(`${S}/repos/${r}/git/trees`,{base_tree:s,tree:i},{headers:R(e,{"Content-Type":"application/json"})});const p=f.data.sha;f=await w.post(`${S}/repos/${r}/git/commits`,{message:o,tree:p,parents:[c.commit.sha]},{headers:R(e,{"Content-Type":"application/json"})});const g=f.data.sha;f=await w.patch(`${S}/repos/${r}/git/refs/heads/${c.name}`,{sha:g},{headers:R(e,{"Content-Type":"application/json"})})}async function ft({token:r}){var t;try{console.log("testing token",r);const e=await w.get(`${S}/user`,{headers:R(r)});return console.log(e.status,e.data),!0}catch(e){if((e==null?void 0:e.response)&&((t=e==null?void 0:e.response)==null?void 0:t.status)===401)return console.log("401",e.response.data),!1}}var y=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function dt(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fe={},k={},J={};(function(r){var t=y&&y.__extends||function(){var u=function(h,d){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,_){v.__proto__=_}||function(v,_){for(var P in _)Object.prototype.hasOwnProperty.call(_,P)&&(v[P]=_[P])},u(h,d)};return function(h,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");u(h,d);function v(){this.constructor=h}h.prototype=d===null?Object.create(d):(v.prototype=d.prototype,new v)}}();Object.defineProperty(r,"__esModule",{value:!0}),r.createJSONRPCNotification=r.createJSONRPCRequest=r.createJSONRPCSuccessResponse=r.createJSONRPCErrorResponse=r.JSONRPCErrorCode=r.JSONRPCErrorException=r.isJSONRPCResponses=r.isJSONRPCResponse=r.isJSONRPCRequests=r.isJSONRPCRequest=r.isJSONRPCID=r.JSONRPC=void 0,r.JSONRPC="2.0";var e=function(u){return typeof u=="string"||typeof u=="number"||u===null};r.isJSONRPCID=e;var i=function(u){return u.jsonrpc===r.JSONRPC&&u.method!==void 0&&u.result===void 0&&u.error===void 0};r.isJSONRPCRequest=i;var o=function(u){return Array.isArray(u)&&u.every(r.isJSONRPCRequest)};r.isJSONRPCRequests=o;var n=function(u){return u.jsonrpc===r.JSONRPC&&u.id!==void 0&&(u.result!==void 0||u.error!==void 0)};r.isJSONRPCResponse=n;var a=function(u){return Array.isArray(u)&&u.every(r.isJSONRPCResponse)};r.isJSONRPCResponses=a;var l=function(u,h,d){var v={code:u,message:h};return d!=null&&(v.data=d),v},c=function(u){t(h,u);function h(d,v,_){var P=u.call(this,d)||this;return Object.setPrototypeOf(P,h.prototype),P.code=v,P.data=_,P}return h.prototype.toObject=function(){return l(this.code,this.message,this.data)},h}(Error);r.JSONRPCErrorException=c,function(u){u[u.ParseError=-32700]="ParseError",u[u.InvalidRequest=-32600]="InvalidRequest",u[u.MethodNotFound=-32601]="MethodNotFound",u[u.InvalidParams=-32602]="InvalidParams",u[u.InternalError=-32603]="InternalError"}(r.JSONRPCErrorCode||(r.JSONRPCErrorCode={}));var s=function(u,h,d,v){return{jsonrpc:r.JSONRPC,id:u,error:l(h,d,v)}};r.createJSONRPCErrorResponse=s;var f=function(u,h){return{jsonrpc:r.JSONRPC,id:u,result:h!=null?h:null}};r.createJSONRPCSuccessResponse=f;var p=function(u,h,d){return{jsonrpc:r.JSONRPC,id:u,method:h,params:d}};r.createJSONRPCRequest=p;var g=function(u,h){return{jsonrpc:r.JSONRPC,method:u,params:h}};r.createJSONRPCNotification=g})(J);var E={};Object.defineProperty(E,"__esModule",{value:!0});E.DefaultErrorCode=void 0;E.DefaultErrorCode=0;var K=y&&y.__awaiter||function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},X=y&&y.__generator||function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(e=0)),e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(k,"__esModule",{value:!0});k.JSONRPCClient=void 0;var N=J,q=E,qe=function(){function r(t,e){this._send=t,this.createID=e,this.idToResolveMap=new Map,this.id=0}return r.prototype._createID=function(){return this.createID?this.createID():++this.id},r.prototype.timeout=function(t,e){var i=this;e===void 0&&(e=function(a){return(0,N.createJSONRPCErrorResponse)(a,q.DefaultErrorCode,"Request timeout")});var o=function(a,l){var c=setTimeout(function(){a.forEach(function(s){var f=i.idToResolveMap.get(s);f&&(i.idToResolveMap.delete(s),f(e(s)))})},t);return l().then(function(s){return clearTimeout(c),s},function(s){return clearTimeout(c),Promise.reject(s)})},n=function(a,l){var c=(Array.isArray(a)?a:[a]).map(function(s){return s.id}).filter(Y);return o(c,function(){return i.requestAdvanced(a,l)})};return{request:function(a,l,c){var s=i._createID();return o([s],function(){return i.requestWithID(a,l,c,s)})},requestAdvanced:function(a,l){return n(a,l)}}},r.prototype.request=function(t,e,i){return this.requestWithID(t,e,i,this._createID())},r.prototype.requestWithID=function(t,e,i,o){return K(this,void 0,void 0,function(){var n,a;return X(this,function(l){switch(l.label){case 0:return n=(0,N.createJSONRPCRequest)(o,t,e),[4,this.requestAdvanced(n,i)];case 1:return a=l.sent(),a.result!==void 0&&!a.error?[2,a.result]:a.result===void 0&&a.error?[2,Promise.reject(new N.JSONRPCErrorException(a.error.message,a.error.code,a.error.data))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},r.prototype.requestAdvanced=function(t,e){var i=this,o=Array.isArray(t);Array.isArray(t)||(t=[t]);var n=t.filter(function(c){return Y(c.id)}),a=n.map(function(c){return new Promise(function(s){return i.idToResolveMap.set(c.id,s)})}),l=Promise.all(a).then(function(c){return o||!c.length?c:c[0]});return this.send(o?t:t[0],e).then(function(){return l},function(c){return n.forEach(function(s){i.receive((0,N.createJSONRPCErrorResponse)(s.id,q.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),l})},r.prototype.notify=function(t,e,i){var o=(0,N.createJSONRPCNotification)(t,e);this.send(o,i).then(void 0,function(){})},r.prototype.send=function(t,e){return K(this,void 0,void 0,function(){return X(this,function(i){return[2,this._send(t,e)]})})},r.prototype.rejectAllPendingRequests=function(t){this.idToResolveMap.forEach(function(e,i){return e((0,N.createJSONRPCErrorResponse)(i,q.DefaultErrorCode,t))}),this.idToResolveMap.clear()},r.prototype.receive=function(t){var e=this;Array.isArray(t)||(t=[t]),t.forEach(function(i){var o=e.idToResolveMap.get(i.id);o&&(e.idToResolveMap.delete(i.id),o(i))})},r}();k.JSONRPCClient=qe;var Y=function(r){return r!=null},de={};Object.defineProperty(de,"__esModule",{value:!0});var A={},j=y&&y.__assign||function(){return j=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},j.apply(this,arguments)},Z=y&&y.__awaiter||function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},ee=y&&y.__generator||function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(e=0)),e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},De=y&&y.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var i=0,o=t.length,n;i<o;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return r.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(A,"__esModule",{value:!0});A.JSONRPCServer=void 0;var b=J,xe=E,Le=function(){return(0,b.createJSONRPCErrorResponse)(null,b.JSONRPCErrorCode.ParseError,"Parse error")},ze=function(r){return(0,b.createJSONRPCErrorResponse)((0,b.isJSONRPCID)(r.id)?r.id:null,b.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Be=function(r){return(0,b.createJSONRPCErrorResponse)(r,b.JSONRPCErrorCode.MethodNotFound,"Method not found")},Fe=function(){function r(t){t===void 0&&(t={});var e;this.mapErrorToJSONRPCErrorResponse=He,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(e=t.errorListener)!==null&&e!==void 0?e:console.warn}return r.prototype.hasMethod=function(t){return!!this.nameToMethodDictionary[t]},r.prototype.addMethod=function(t,e){this.addMethodAdvanced(t,this.toJSONRPCMethod(e))},r.prototype.toJSONRPCMethod=function(t){return function(e,i){var o=t(e.params,i);return Promise.resolve(o).then(function(n){return Ve(e.id,n)})}},r.prototype.addMethodAdvanced=function(t,e){var i;this.nameToMethodDictionary=j(j({},this.nameToMethodDictionary),(i={},i[t]=e,i))},r.prototype.receiveJSON=function(t,e){var i=this.tryParseRequestJSON(t);return i?this.receive(i,e):Promise.resolve(Le())},r.prototype.tryParseRequestJSON=function(t){try{return JSON.parse(t)}catch{return null}},r.prototype.receive=function(t,e){return Array.isArray(t)?this.receiveMultiple(t,e):this.receiveSingle(t,e)},r.prototype.receiveMultiple=function(t,e){return Z(this,void 0,void 0,function(){var i,o=this;return ee(this,function(n){switch(n.label){case 0:return[4,Promise.all(t.map(function(a){return o.receiveSingle(a,e)}))];case 1:return i=n.sent().filter(Ue),i.length===1?[2,i[0]]:i.length?[2,i]:[2,null]}})})},r.prototype.receiveSingle=function(t,e){return Z(this,void 0,void 0,function(){var i,o;return ee(this,function(n){switch(n.label){case 0:return i=this.nameToMethodDictionary[t.method],(0,b.isJSONRPCRequest)(t)?[3,1]:[2,ze(t)];case 1:return[4,this.callMethod(i,t,e)];case 2:return o=n.sent(),[2,Ge(t,o)]}})})},r.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.middleware?this.middleware=this.combineMiddlewares(De([this.middleware],t,!0)):this.middleware=this.combineMiddlewares(t)},r.prototype.combineMiddlewares=function(t){return t.length?t.reduce(this.middlewareReducer):null},r.prototype.middlewareReducer=function(t,e){return function(i,o,n){return t(function(a,l){return e(i,a,l)},o,n)}},r.prototype.callMethod=function(t,e,i){var o=this,n=function(l,c){return t?t(l,c):l.id!==void 0?Promise.resolve(Be(l.id)):Promise.resolve(null)},a=function(l){return o.errorListener('An unexpected error occurred while executing "'.concat(e.method,'" JSON-RPC method:'),l),Promise.resolve(o.mapErrorToJSONRPCErrorResponseIfNecessary(e.id,l))};try{return(this.middleware||We)(n,e,i).then(void 0,a)}catch(l){return a(l)}},r.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(t,e){return t!==void 0?this.mapErrorToJSONRPCErrorResponse(t,e):null},r}();A.JSONRPCServer=Fe;var Ue=function(r){return r!==null},We=function(r,t,e){return r(t,e)},Ve=function(r,t){return r!==void 0?(0,b.createJSONRPCSuccessResponse)(r,t):null},He=function(r,t){var e,i=(e=t==null?void 0:t.message)!==null&&e!==void 0?e:"An unexpected error occurred",o=xe.DefaultErrorCode,n;return t instanceof b.JSONRPCErrorException&&(o=t.code,n=t.data),(0,b.createJSONRPCErrorResponse)(r,o,i,n)},Ge=function(r,t){return t||(r.id!==void 0?(0,b.createJSONRPCErrorResponse)(r.id,b.JSONRPCErrorCode.InternalError,"Internal error"):null)},I={},Qe=y&&y.__awaiter||function(r,t,e,i){function o(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(f){try{s(i.next(f))}catch(p){a(p)}}function c(f){try{s(i.throw(f))}catch(p){a(p)}}function s(f){f.done?n(f.value):o(f.value).then(l,c)}s((i=i.apply(r,t||[])).next())})},Ke=y&&y.__generator||function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,o,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(s){return function(f){return c([s,f])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(e=0)),e;)try{if(i=1,o&&(n=s[0]&2?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,o=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){e.label=s[1];break}if(s[0]===6&&e.label<n[1]){e.label=n[1],n=s;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(s);break}n[2]&&e.ops.pop(),e.trys.pop();continue}s=t.call(r,e)}catch(f){s=[6,f],o=0}finally{i=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(I,"__esModule",{value:!0});I.JSONRPCServerAndClient=void 0;var M=J,Xe=function(){function r(t,e,i){i===void 0&&(i={});var o;this.server=t,this.client=e,this.errorListener=(o=i.errorListener)!==null&&o!==void 0?o:console.warn}return r.prototype.applyServerMiddleware=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];(t=this.server).applyMiddleware.apply(t,e)},r.prototype.hasMethod=function(t){return this.server.hasMethod(t)},r.prototype.addMethod=function(t,e){this.server.addMethod(t,e)},r.prototype.addMethodAdvanced=function(t,e){this.server.addMethodAdvanced(t,e)},r.prototype.timeout=function(t){return this.client.timeout(t)},r.prototype.request=function(t,e,i){return this.client.request(t,e,i)},r.prototype.requestAdvanced=function(t,e){return this.client.requestAdvanced(t,e)},r.prototype.notify=function(t,e,i){this.client.notify(t,e,i)},r.prototype.rejectAllPendingRequests=function(t){this.client.rejectAllPendingRequests(t)},r.prototype.receiveAndSend=function(t,e,i){return Qe(this,void 0,void 0,function(){var o,n;return Ke(this,function(a){switch(a.label){case 0:return(0,M.isJSONRPCResponse)(t)||(0,M.isJSONRPCResponses)(t)?(this.client.receive(t),[3,4]):[3,1];case 1:return(0,M.isJSONRPCRequest)(t)||(0,M.isJSONRPCRequests)(t)?[4,this.server.receive(t,e)]:[3,3];case 2:return o=a.sent(),o?[2,this.client.send(o,i)]:[3,4];case 3:return n="Received an invalid JSON-RPC message",this.errorListener(n,t),[2,Promise.reject(new Error(n))];case 4:return[2]}})})},r}();I.JSONRPCServerAndClient=Xe;(function(r){var t=y&&y.__createBinding||(Object.create?function(i,o,n,a){a===void 0&&(a=n);var l=Object.getOwnPropertyDescriptor(o,n);(!l||("get"in l?!o.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return o[n]}}),Object.defineProperty(i,a,l)}:function(i,o,n,a){a===void 0&&(a=n),i[a]=o[n]}),e=y&&y.__exportStar||function(i,o){for(var n in i)n!=="default"&&!Object.prototype.hasOwnProperty.call(o,n)&&t(o,i,n)};Object.defineProperty(r,"__esModule",{value:!0}),e(k,r),e(de,r),e(J,r),e(A,r),e(I,r)})(fe);const m=new fe.JSONRPCClient(r=>{window.adsk.fusionSendData("jsonrpc",JSON.stringify(r))});window.fusionJavaScriptHandler={handle:function(r,t){try{r=="jsonrpc"&&m.receive(JSON.parse(t))}catch{console.log("exception caught with command: "+r+", data: "+t)}return"OK"}};class Ye{constructor(){O(this,"isFusion360");O(this,"version");O(this,"latestVersion",4);O(this,"updateUrl","https://github.com/MapleLeafMakers/VoronConstruct360/releases");this.isFusion360=!0,this.version=-1}async get_version(){if(this.version===-1)try{this.version=await m.request("get_version",{})}catch{this.version=1}return this.version}async kv_get({key:t,or:e=null}){const i=await m.request("kv_get",{key:t});return i===null?e:i}async kv_mget({keys:t,pattern:e}){return await m.request("kv_mget",{keys:t,pattern:e})}async kv_set({key:t,value:e}){await m.request("kv_set",{key:t,value:e})}async kv_mset(t){await m.request("kv_mset",{obj:t})}async kv_keys({pattern:t}){return await m.request("kv_keys",{pattern:t})}async kv_del({key:t}){await m.request("kv_del",{key:t})}async kv_mdel({keys:t,pattern:e}){await m.request("kv_mdel",{keys:t,pattern:e})}async get_screenshot({width:t,height:e,transparent:i,antialias:o}){return await m.request("get_screenshot",{width:t,height:e,transparent:i,antialias:o})}async open_model({url:t,token:e,content_type:i,filename:o}){await m.request("open_model",{url:t,token:e,content_type:i,filename:this._version<2?void 0:o})}async import_model({url:t,token:e,content_type:i,filename:o}){await m.request("import_model",{url:t,token:e,content_type:i,filename:this._version<2?void 0:o})}async export_model({step:t,f3d:e}){return await m.request("export_model",{step:t,f3d:e})}async close(){await m.request("close",{})}async autothumb({url:t,content_type:e,token:i,width:o,height:n,transparent:a,antialias:l}){return await m.request("autothumb",{url:t,content_type:e,token:i,width:o,height:n,transparent:a,antialias:l})}}function Ze(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}class et{constructor(){O(this,"isFusion360");O(this,"version",1);O(this,"latestVersion",1);this.isFusion360=!1}async get_version(){return this.version}async kv_get({key:t,or:e}){const i=localStorage.getItem(t);return i===null?e:JSON.parse(i)}async kv_mget({keys:t,pattern:e}){const i={},o=[...t||[]];e&&o.push(...await this.kv_keys({pattern:e}));for(const n of o)i[n]=await this.kv_get({key:n});return i}async kv_set({key:t,value:e}){try{localStorage.setItem(t,JSON.stringify(e))}catch(i){if(!t.startsWith("cache:"))throw i}}async kv_mset(t){for(const[e,i]of Object.entries(t))try{localStorage.setItem(e,JSON.stringify(i))}catch(o){if(!e.startsWith("cache:"))throw o}}async kv_keys({pattern:t}){const e=new RegExp(`^${t.split("%").map(Ze).join(".*")}$`),i=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&n.match(e)&&i.push(n)}return i}async kv_del({key:t}){localStorage.removeItem(t)}async kv_mdel({keys:t,pattern:e}){const i=[...t||[]];e&&i.push(...await this.kv_keys({pattern:e}));for(const o of i)localStorage.removeItem(o)}get_screenshot({}){throw new Error("Method not implemented.")}async open_model({url:t,token:e,content_type:i,filename:o}){const n=await Me({url:t,token:e}),a=URL.createObjectURL(n);o||(o="model");const l=document.createElement("a");l.href=a,l.download=`${o}.${i}`,l.setAttribute("target","_blank"),l.click(),URL.revokeObjectURL(a)}import_model({}){throw new Error("Method not implemented.")}export_model({}){throw new Error("Method not implemented.")}close(){throw new Error("Method not implemented.")}autothumb({}){throw new Error("Method not implemented.")}}const tt=async()=>{if(window.adsk===void 0&&(await new Promise(t=>setTimeout(t,100)),window.adsk===void 0))return new et;const r=new Ye;try{console.log("Backend Version: ",await r.get_version())}catch(t){console.error(t)}return r};function z(r){for(const t of r)t.type==="repo"?t.icon="mdi-github":t.type==="org"?t.icon="mdi-domain":t.type==="tree"?t.icon="mdi-folder":t.type==="blob"&&(t.icon="mdi-cube-outline"),t.selectable=t.type==="blob",t.expandable=t.type==="repo"||t.type==="tree"||t.type==="org",t.children&&z(t.children)}const ht=Re("core",{state:()=>({globalCursor:"",search:"",tree:$([]),token:"",backend:{},preferences:{showThumbnails:!1,previewSize:128,showManagementUI:!1,interfaceUrl:"",fontSize:12,searchFolderNames:!0}}),getters:{},actions:{getTopLevelNode(r){var t;for(const e of this.tree){if(e.id===r)return e;if(e.type==="org"){const i=(t=e.children)==null?void 0:t.filter(o=>o.id===r);if(i)return i[0]}}},async loadState(){this.backend=await tt();const{token:r,collections:t,preferences:e}=await this.backend.kv_mget({keys:["token","collections","preferences"]});if(r&&(this.token=r),t){const i=t;for(const o of i)o.selectable=!1,o.icon=o.type==="repo"?"mdi-github":"mdi-domain",Array.isArray(o.repositories)&&o.repositories.length>0&&(o.repositories=o.repositories.map(n=>typeof n=="string"?{repr:n,repo:n.split("/").slice(0,2).join("/"),path:n.split("/").slice(2).join("/"),branch:n.split("#")[1]||null}:n));this.tree=$(i);for(const o of this.tree)if(o.type==="repo")this.reloadCollection({nodeId:o.id});else if(o.type==="org")for(const n of o.children||[])this.reloadCollection({nodeId:n.id})}e&&Object.assign(this.preferences,e)},async saveToken(){this.backend.kv_set({key:"token",value:this.token})},async saveCollections(){this.backend.kv_set({key:"collections",value:this.tree.map(r=>({...r,children:(r.children||[]).filter(t=>t.type==="repo").map(t=>({...t,children:[]}))}))})},async savePreferences(){return this.backend.kv_set({key:"preferences",value:{...this.preferences}})},async reloadCollection({nodeId:r,startup:t}){t===void 0&&(t=!1);let e;for(const o of this.tree){if(o.type==="org"){const n=(o.children||[]).findIndex(a=>a.id===r);if(n!==-1){e=o.children[n];break}}if(o.id===r){e=o;break}}if(!e)throw new Error("Node not found");console.log("reloading collection",e),e.lazy="loading";let i;if(e.type==="repo")i=await G({repositories:e==null?void 0:e.repositories.map(o=>o.repr),token:this.token,index:!0,id_prefix:e.id,setLoadingMessage:()=>null}),e.lazy=!1,z(i),e.children=$(i);else if(e.type==="org"){i=(await Te({org:e.org,token:this.token})).map(o=>({...o,id:_e()})),console.log("is org",i);for(const o of i)o.children=await G({repositories:o.repositories.map(n=>n.repr),token:this.token,id_prefix:o.id,index:!0,setLoadingMessage:()=>null});i=i.filter(o=>{var n;return(((n=o.children)==null?void 0:n.length)||0)>0}),e.lazy=!1,z(i),e.children=$(i),await this.saveCollections()}},async setNodeThumbnail(r){var e,i,o,n,a;const t=await je({url:((i=(e=r==null?void 0:r.content_types)==null?void 0:e.thumb)==null?void 0:i.url)||((n=(o=r==null?void 0:r.content_types)==null?void 0:o.svg)==null?void 0:n.url),token:this.token,content_type:(a=r==null?void 0:r.content_types)!=null&&a.thumb?"image/png":"image/svg+xml"});r.img=t}}});export{ot as Q,st as a,Te as b,ct as c,je as d,ut as e,y as f,lt as g,dt as h,Me as i,at as s,ht as u,ft as v};
